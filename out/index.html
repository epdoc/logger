<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Documentation Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.simplex.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Documentation</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="CallbackTransport.html">CallbackTransport</a></li><li><a href="ConsoleTransport.html">ConsoleTransport</a></li><li><a href="Logger.html">Logger</a></li><li><a href="LogglyTransport.html">LogglyTransport</a></li><li><a href="LogManager.html">LogManager</a></li><li><a href="Response.html">Response</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#formatMS">formatMS</a></li><li><a href="global.html#reqId">reqId</a></li><li><a href="global.html#Request">Request</a></li><li><a href="global.html#self">self</a></li>
				</ul>
			</li>
			
		</ul>
		<div class="col-sm-3 col-md-3">
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                    <div class="input-group-btn">
                        <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
            </form>
        </div>
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-8">
	
		<div id="main">
			

	
	











	
	





    <section class="readme-section">
        <article><h1>epdoc-logger</h1><p>A logging module supporting built-in and custom transports, Express 4 response mixins, 
rich message and data syntax, and chainable methods for recording log events.
Generally supports <a href="https://github.com/winstonjs/winston">Winston's</a> logging method calls
for simpler messages, but with the addition of a substantial number of new methods, 
many of which can be chained to create richer output with more columns of data.</p>
<p><a href="http://jpravetz.github.io/epdoc-logger/out/index.html">This page and API Reference are also formatted and available here</a>.</p>
<h2>Install</h2><pre class="prettyprint source lang-bash"><code>npm install --save epdoc-logger</code></pre><h2>Quick Start</h2><p>Log to the console.</p>
<pre class="prettyprint source lang-javascript"><code>var log = require('epdoc-logger').start().get();

log.info(&quot;Hello world&quot;);</code></pre><pre class="prettyprint source lang-bash"><code>[&quot;00:00.001&quot;,&quot;INFO&quot;,0,&quot;&quot;,&quot;logger&quot;,&quot;logger.push.success&quot;,&quot;Set logger to Console&quot;,{},{&quot;transport&quot;:&quot;Console&quot;}]
[&quot;00:00.015&quot;,&quot;INFO&quot;,0,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;Hello world&quot;,{}]</code></pre><p>Buffer messages until your logger is set up, then output to a file.</p>
<pre class="prettyprint source lang-javascript"><code>var logMgr = require('epdoc-logger').logMgr();
var log = logMgr.get('main');
log.info(&quot;Starting application&quot;);

var config = require('config.json');
logMgr.setTransport('file',{path:config.logFile,timestamp:'iso'}); 

log.info(&quot;Hello world&quot;);</code></pre><pre class="prettyprint source lang-bash"><code>[&quot;2016-03-29T04:19:45.920Z&quot;,&quot;INFO&quot;,&quot;main&quot;,&quot;&quot;,&quot;Starting application&quot;]
[&quot;2016-03-29T04:19:45.922Z&quot;,&quot;INFO&quot;,&quot;logger&quot;,&quot;logger.push&quot;,&quot;Setting logger to File (/path/to/file.log)&quot;,{&quot;transport&quot;:&quot;File (/path/to/file.log)&quot;}]
[&quot;2016-03-29T04:19:45.924Z&quot;,&quot;INFO&quot;,&quot;logger&quot;,&quot;logger.push.success&quot;,&quot;Set logger to File (/path/to/file.log)&quot;,{&quot;transport&quot;:&quot;File (/path/to/file.log)&quot;}]
[&quot;2016-03-29T04:19:45.926Z&quot;,&quot;INFO&quot;,&quot;main&quot;,&quot;&quot;,&quot;Hello world&quot;]</code></pre><p>Log to <a href="http://loggly.com">loggly.com</a>, buffering and making batch calls to loggly.</p>
<pre class="prettyprint source lang-javascript"><code>var logMgr = require('epdoc-logger').logMgr();
var log = logMgr.get('main');
log.info(&quot;Starting application&quot;);

logMgr.setTransport('loggly',{token:'MyToken'}); 

log.info(&quot;Hello world&quot;);

// log a message count for all the different log levels
logMgr.writeCount();

// Shutdown properly so loggly message buffer is flushed
logMgr.destroying().then(function() {
    done();
}, function(err) {
    done(err);
});</code></pre><h2>Classes</h2><p>There are two main objects used for logging:</p>
<ul>
<li><a href="LogManager.html">LogManager</a><ul>
<li>Usually a singleton</li>
<li>Used to configure the transport, set global options, and start writing to the transport</li>
<li>Can also be used to directly write to the transport (see <a href="LogManager.html#logParams">LogManager#logParams</a> and <a href="LogManager.html#logMessage">LogManager#logMessage</a>)</li>
<li>See the <a href="LogManager.html">Log Manager API Reference</a></li>
</ul>
</li>
<li><a href="Logger.html">Logger</a><ul>
<li>A per-emitter object</li>
<li>Create a new log object for every file (emitter), or for every request</li>
<li>Chainable methods via which to write log output</li>
<li>See the <a href="LogManager.html">Logger API Reference</a></li>
</ul>
</li>
</ul>
<p>You can access these two classes off of the exported epdoc-logger module:</p>
<pre class="prettyprint source lang-javascript"><code>var epdocLogger = require('epdoc-logger');
var LogManager = epdocLogger.LogManager;
var Logger = epdocLogger.Logger;</code></pre><h3>LogManager Class</h3><p>A shortcut for getting a <a href="LogManager.html">LogManager</a> singleton is to call the module's <code>logMgr</code> method.</p>
<pre class="prettyprint source lang-javascript"><code>var logMgr = require('epdoc-logger').logMgr();</code></pre><p>This is equivalent to:</p>
<pre class="prettyprint source lang-javascript"><code>var epdocLogger = require('epdoc-logger');
var LogManager = epdocLogger.LogManager;
var logMgr = new LogManager();</code></pre><p>Because you may need to load config information before configuring your transport you must 
explicitly start logging by calling <a href="LogManager.html#start">LogManager#start</a>. And because some 
log tranports are buffered, you should also call <a href="LogManager.html#flushing">LogManager#flushing</a> or 
<a href="LogManager.html#destroying">LogManager#destroying</a> before shutting down.</p>
<h2>Logger Class</h2><p><a href="Logger.html">Logger</a> object are created by calling <code>new Logger()</code>. Typically you would create a new Logger object for
every javascript file and set a unique module name (<em>aka emitter</em>)_ for that object. 
Alternatively, when responding to requests, for example when using <a href="http://expressjs.com">Express</a>,
it is a better idea to tie the emitter to the request. This is described later in this document.</p>
<p>Loggers are created by calling <a href="LogManager.html#get">LogManager#get</a>.</p>
<pre class="prettyprint source lang-javascript"><code>var log = logMgr.get('emitter-name');

// This is equivalent
var log = new Logger(logMgr,'emitter-name');

// A shortcut that is also equivalent and that uses a global LogManager object
var log = require('epdoc-logger').get('emitter-name');</code></pre><h2>Configuring Transports</h2><p>The module has built-in support for the following transports:</p>
<ul>
<li>console (default)</li>
<li>file (specify path) - logs as a JSON array</li>
<li><a href="http://www.sos.powerflasher.com/developer-tools/sosmax/home/">SOS Max</a> - <em>SOS max is the POWERFLASHER Socket Output Server - a fast and helpful programmer tool with graphical
user interface to display log messages for debugging purpose.</em><ul>
<li>SOS Max appears to not work on the latest version of Mac OS X.</li>
</ul>
</li>
<li>line - A line buffer/callback used only for automated testing</li>
<li>loggly - See <a href="http://loggly.com">loggly.com</a>.</li>
</ul>
<p>On startup the logger can wait for a transport to be initialized before logging, or it can begin writing log messages
immediately (if LogManager#autoRun is set. 
By default the logger uses the Console Transport and must be started manually.</p>
<p>If LogManager#autoRun is not set, then a call to <a href="LogManager.html#start">LogManager#start</a> or <a href="LogManager.html#setTransport">LogManager#setTransport</a> will begin logging. 
Messages are buffered prior to the transport being intitialized, so prior to this event no messages will be lost.</p>
<h3>Logging to Console</h3><p>Main File</p>
<pre class="prettyprint source lang-javascript"><code>var gLogMgr = require('epdoc-logger').logMgr(a).start();
var log = gLogMgr.get('main');

log.info(&quot;Return value for %s is %s&quot;, &quot;hello&quot;, &quot;world&quot; );
log.data('req',{a:3}).info();
log.data('res',{b:4}).info(&quot;My message with %s support&quot;, 'formatting');</code></pre><p>Other File</p>
<pre class="prettyprint source lang-javascript"><code>var log = require('epdoc-logger').get('other');

log.info(&quot;Hello world&quot;);</code></pre><h3>Logging to a File</h3><p>This shows the more general use of the logger object.</p>
<pre class="prettyprint source lang-javascript"><code>var gLogMgr = require('epdoc-logger').logger();
var log = gLogMgr.get('MyModule');
logger.setTransport( 'file', { path: 'path/to/myfile.log' } );

log.info(&quot;Return value for %s is %s&quot;, &quot;hello&quot;, &quot;world&quot; );
log.data('req',{a:3}).info();
log.data('res',{b:4}).info(&quot;My message with %s support&quot;, 'formatting');</code></pre><p>Log output to a file is a JSON-formatted array with [ date, level, sid, module, message, data ], as defined
under the LogMessage function (below).</p>
<h3>Logging to SOS</h3><p>When you set the logger to SOS the setLogger method returns immediately, but the socket takes awhile to
initialize. In the meantime log messages are queued up and getLogger() returns the SOS logger. Once the
connection is made the messages are flushed. If the connection is refused the messages are flushed to the
previously set logger output (usually the console).</p>
<pre class="prettyprint source lang-javascript"><code>var logger = require('epdoc-logger').logger({autoRun:false});
var log = Logger.get('MyModule');
logger.setTransport( { type: 'sos', bIncludeSessionId: false } );

log.info(&quot;Return value for %s is %s&quot;, &quot;hello&quot;, &quot;world&quot; );</code></pre><h3>Logging to Loggly</h3><p>Loggly output is buffered and sent in batches. As a result it is important to shutdown logging before exiting.
See the example earlier in this readme showing how this is done.</p>
<h3>Advanced (needs updating)</h3><p>Transports can also be closed using <code>unsetLogger</code>. In this event logging will revert to the previously 
specified transport. For example, if you specify an SOS transport and the SOS application is closed, 
logging will return back to the console and the console will be (re)started automatically. 
If an active transport closes on it's own (<em>e.g.</em> SOS Max application exits) 
the active transport is automatically shifted off the list of transports as if calling <code>unsetLogger</code>.</p>
<p>See the files in the test folder for additional examples and information.</p>
<p>A call to <code>setLogger</code> will stop the previously activated transport (if any),
add the new transport to the stack and automatically start the new transport.</p>
<p>Transports are maintained in a list. When calling <code>setLogger</code> you are unshifting a transport onto
the head of the list. When you call <code>unsetLogger</code> you are stopping the transport, shifting it off the list
of transports, and restoring and restarting the previously set transport.</p>
<p>The Logger will buffer messages while switching transports,
however individual transports can do their own buffering (<em>e.g.</em> file).
If a transport closes prematurely, it's buffer may be lost.</p>
<p>There are probably few instances where you would need to manually call <code>unsetLogger</code> or deal with the list
of transports, except where wishing to start and stop an <em>SOS</em>-style transport.</p>
<p>The <code>setLogger(type,options)</code> has the following parameters:</p>
<ul>
<li><code>type</code> - The transport type, which is either a string (one of the built-in transports 'console', 'file' or
'sos') or the class of a custom transport.</li>
<li><code>options</code> - An object with the following optional parameters<ul>
<li><code>path</code> - 'path/to/myfile.log', used when type is <code>file</code></li>
<li><code>dateFormat</code> - one of 'ISO' or 'formatMS', default is dependent on the transport but is 
usually 'formatMS' (not used with loggly)</li>
<li><code>bIncludeSid</code> - Indicates whether the sessionId should be included in the output, defaults to true</li>
</ul>
</li>
</ul>
<p>To build your own custom transport class it
just copy or subclass the console transport (obtained using <code>Logger.getLoggerClass('console')</code>)
and modify as has been done for the file and sos transports.</p>
<p>Loggly has these additional options:</p>
<ul>
<li><code>token</code> (required) Token issued by [loggly.com] for your account</li>
<li><code>bufferSize</code> (optional, default 100 messages) Number of messages to buffer</li>
<li><code>flushInterval</code> (optional, default 5000 ms) An interval timer that flushes messages if there are any</li>
</ul>
<h2>Logging Example</h2><pre class="prettyprint source lang-javascript"><code>// Get the global logger object

var logMgr = require('epdoc-logger').logMgr({sid:false});

// Logger static methods

logMgr.setTransport( 'file', { path: 'path/to/myfile.log', dateFormat: 'ISO', sid: false } );
var loggerType = logMgr.getCurrentTransport().type();        // Will return the transport type of the logger
logMgr.setLevel( 'warn' );
var startTime = logMgr.getStartTime();                    // Milliseconds

// Get a Logger object for this file or module

var log = logMgr.get('MyClassName');

// Instance methods. Each line outputs a message.

log.data('a',1).data('b',[2,3]).info();
log.data({a:1,b:[2,3]}).info(&quot;My message&quot;);
log.info( &quot;I just want to say %s to the %s&quot;, &quot;Hello&quot;, &quot;World&quot; );
log.action('obj.update').debug( &quot;We %s formatted messages&quot;, &quot;do&quot; );
log.error( new Error(&quot;My error&quot;) );
log.verbose( &quot;The default is to not output verbose messages, so this will not by default be output&quot; );
log.warn( &quot;Danger Will Robinson, danger&quot; );
log.fault( &quot;Restarting server in %d seconds&quot;, 10 );

// Outputs a new message
log.date();             // Output now's date/time
log.separator();        // Output a line separator

log.log( 'info', &quot;This method %s supports util.format style formating&quot;, &quot;also&quot; );

// Enable verbose messages to be output for this log object (overrides global setting)
log.setLevel( &quot;verbose&quot; );</code></pre><h3><a href="Logger.html">Logger</a> Method Chaining</h3><p>Most <a href="Logger.html">Logger</a> methods support chaining.</p>
<p>The following methods all add column values to the message that is output but do not output the message:</p>
<ul>
<li><code>action</code> - Sets the action column value to this string.</li>
<li><code>data</code> - Sets the data column value. Either pass in a key value pair, which is then added to the data
object, or an object, which the data object is then set to.</li>
<li><code>set</code> - Sets a value in a <code>custom</code> column and keeps this value for the duration of the Log object's
lifespan. This column is currently only output to the loggly transport.</li>
</ul>
<p>The following methods result in a message being output with the corresponding log level set:</p>
<ul>
<li><code>info</code></li>
<li><code>warn</code></li>
<li><code>debug</code></li>
<li><code>verbose</code></li>
<li><code>error</code></li>
<li><code>fatal</code></li>
</ul>
<p>The following methods result in a message output with log level set to INFO:</p>
<ul>
<li><code>separator</code> - Output a separator line containing # characters</li>
<li><code>date</code> - Outputs localtime, utctime and uptime</li>
<li><code>log</code> - Outputs level and string message, for example: <code>log.log( 'info', &quot;Found %d lines&quot;, iLines )</code>.<ul>
<li><code>level</code> - Optional level (defaults to <code>info</code>)</li>
<li><code>msg</code> - String to output, formatted with <code>util.format</code></li>
</ul>
</li>
</ul>
<h2>Custom Log Levels</h2><p>Log level defaults are set in LogManager:</p>
<pre class="prettyprint source lang-javascript"><code>    this.LEVEL_DEFAULT = 'debug';       // Default threshold level for outputting logs
    this.LEVEL_INFO = 'info';           // If changing LEVEL_ORDER, what level should internally generated info messages be output at?
    this.LEVEL_WARN = 'warn';           // If changing LEVEL_ORDER, what level should internally generated warn messages be output at?
    this.LEVEL_ORDER = ['verbose', 'debug', 'info', 'warn', 'error', 'fatal'];</code></pre><p>You can customize log levels by setting the value of this array after constructing your LogManager object.
Any subsequently created Logger objects will have methods with the names you have provided. 
Please use lowercase log level names.</p>
<h2>Express Middleware (Needs Updating)</h2><p><em>Note: This section needs to be updated.</em></p>
<p>The included express middleware are instantiated as follows:</p>
<pre class="prettyprint source lang-javascript"><code>var LogMgr = require('epdoc-logger');

var reqId = Logger.middleware().reqId;
var responseLogger = Logger.middleware().responseLogger;
var routeLogger = Logger.middleware().routeLogger;
var routeSeparator = Logger.middleware().routeSeparator;

var app = express();
app.use(reqId());

app.use(app.router);
app.all('*', responseLogger());
app.all('*', routeSeparator());
app.all('*', routeLogger());</code></pre><p>See test/reqtest.js for an example of how to use a stub request and response method to test middleware.
This technique can also be useful if you wish to use the req/res/next mechanism in non-express environments.
As an example, you could have req/res objects for tracking AMQP (RabbitMQ) requests and responses and
associating reqIds with the AMQP requests.</p>
<h3>reqId</h3><p>Adds <code>_reqId</code> and <code>_hrStartTime</code> to the request object. These are used later when logging.</p>
<h3>ResponseLogger</h3><p>The responseLogger middleware mixes custom logging methods, similar to those in the logging object,
into the express <code>response</code> object. This will add request-context-sensitive logging information
to each log message.</p>
<p>As with the logging object, most methods can be chained. An example usage:</p>
<pre class="prettyprint source lang-javascript"><code>function myFunction(req,res,params) {
    res.pushRouteInfo('myFunction');
    res.action('complete').data(params).info('Entering function');
    res.popRouteInfo();
}</code></pre><h3>RouteSeparator</h3><p>Adds a separator line to the log file for each new route.</p>
<h3>RouteLogger</h3><p>Adds an information line to the log file for each new route.</p>
<h2>Test</h2><p>Unit tests are not very good for this modules, however the module is in 
heavy use within our own applications, and so errors are quickly found.</p>
<h2>Action Items</h2><ul>
<li>The express middleware is currently being updated.</li>
<li>Add koa middleware (I don't currently have a koa project going, so this may not happen for awhile)</li>
<li>Loggly support - DONE!</li>
</ul>
<h2>Author</h2><p>Jim Pravetz <a href="&#109;&#97;&#105;&#x6c;&#x74;&#x6f;&#x3a;&#106;&#x70;&#114;&#97;&#x76;&#101;&#x74;&#122;&#64;&#x65;&#112;&#100;&#111;&#99;&#46;&#x63;&#111;&#109;">&#106;&#x70;&#114;&#97;&#x76;&#101;&#x74;&#122;&#64;&#x65;&#112;&#100;&#111;&#99;&#46;&#x63;&#111;&#109;</a></p>
<h2>License</h2><p><a href="https://github.com/strongloop/express/blob/master/LICENSE">MIT</a></p></article>
    </section>







		</div>
	</div>

	<div class="clearfix"></div>

	
		<div class="col-md-3">
			<div id="toc" class="col-md-3 hidden-xs hidden-sm hidden-md"></div>
		</div>
	

</div>
</div>

<div class="modal fade" id="searchResults">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Search results</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
	
		on 2016-03-29T12:04:17-07:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>
<script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>

<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			var id = $( heading ).attr( "id" );
			return id && id.replace(/\~/g, '-inner-').replace(/\./g, '-static-') || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->


<script type="text/javascript">
	$(document).ready(function() {
		SearcherDisplay.init();
	});
</script>

</body>
</html>